#!/bin/bash
TESTFILE="/tmp/testfile.py"
trap "rm -f ${TESTFILE}" EXIT
cat > ${TESTFILE} << EOF
from typing import Iterator


def fib(n: int) -> Iterator[int]:
    a, b = "abc", 1
    while a < n:
        yield a
        a, b = b, a + b


fib(10)
fib("10")
EOF

pretty_out=$(multimetric "${TESTFILE}" 2>/dev/null | jq -S . -)
diff -yq <(echo "${pretty_out}") <(jq -S . "${0}".cmp) && exit 0
echo "Test for ${0} failed: tool output at ${0}.tool"
echo "${pretty_out}" > ${0}.tool
exit 1